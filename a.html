<html>
<head>
<meta charset='utf-8'>
<title>untitled</title>
<meta name="viewport" content="width=device-width, user-scalable=no">
<style>

body {
    margin: 0px;
}
table {
    border-collapse: collapse;
}
th, td {
    padding: 0px;
}

</style>
</head>
<body>
<script src="//code.jquery.com/jquery-1.11.0.min.js"></script>
<script src="//dglittle.github.io/gl519/index.js"></script>
<script src="//dglittle.github.io/gl519/tab.js"></script>
<script src="//dglittle.github.io/gl519/aes.js"></script>
<script src="utils.js"></script>

<script src="//github-access-token-getter.herokuapp.com/index.js"></script>
<script>

var the_text = /*AAA*/'hi there'/*BBB*/

$(function () {
	$(document).ajaxError(function () {
		alert('oh no, AJAX badness happened!')
	})

	var t = $('<textarea/>').val(the_text)
	$('body').append(t)

	$('body').append($('<button/>').text('test').click(function () {
		get_github_access_token('repo', function (access_token) {

			$.ajax({
				type : 'GET',
				url : 'https://api.github.com/repos/dglittle/self-saver/contents/a.html',
				success : function (x) {
					var c = Base64.decode(x.content.replace(/\s/g, ''))

					c = c.replace(/\/\*AAA\*\/.*?\/\*BBB\*\//, '/*AAA*/' + _.json(t.val()) + '/*BBB*/')
					console.log('c = ' + c)

					$.ajax({
						type : 'PUT',
						url : 'https://api.github.com/repos/dglittle/self-saver/contents/a.html?access_token=' + access_token,
						data : _.json({
							path : '/a.html',
							message : 'my commit message',
							content : Base64.encode(c),
							sha : x.sha
						}),
						success : function (x) {
							alert('x = ' + _.json(x))
						}
					})
				}
			})
		})
	}))
})

</script>

</body>
</html>
